<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/image-icons.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-badge/paper-badge.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-styles/paper-styles.html">

<dom-module id="paper-search">

	<template>
		<style>
			:host {
				background: var(--background-color, white);
				display: block;
				padding: 5px 16px;
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}
			
			.input-panel {
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			.icon {
				opacity: var(--dark-secondary-opacity);
			}
						
			#input {
				margin: 0 10px;
				border: 0;
			}
			
			#input[disabled] {
				background: var(--background-color, white);
			}
			
			.badge {
				--paper-badge-background: var(--paper-red-500);
				--paper-badge-opacity: 1;
				--paper-badge-width: 18px;
				--paper-badge-height: 18px;
				--paper-badge-margin-left: 0;
				--paper-badge-margin-bottom: -15px;
			}
		</style>

		<div class='input-panel flex' on-tap='_enable'>
			<iron-icon icon='search' class='icon'></iron-icon>
			<input is='iron-input' id='input' bind-value={{query}} placeholder=[[placeholder]] class='flex' disabled=[[!_enabled]]></input>
		</div>
		<paper-icon-button icon='clear' hidden=[[!query]] on-tap='_tapClear' class='icon'></paper-icon-button>
		<paper-icon-button id='filter' icon='image:tune' on-tap='_tapFilter' class='icon'></paper-icon-button>
		<paper-badge for='filter' label=[[nrSelectedFilters]] class='badge' hidden=[[!nrSelectedFilters]]></paper-badge>
	</template>
	         
</dom-module>

<script>

(function() {

	Polymer({
		is: 'paper-search',

	    properties: {
	    	/** Text for which the user is searching **/
	    	query: {
	    		type: String,
	    		notify: true
	    	},
	    	/** Number of filters the user has been selected (optional) */
			nrSelectedFilters: {
				type: Number,
				value: 0
			},
			placeholder: {
				type: String,
				value: "Search"
			},

			/** Text input box is only opened when the user clicks on it. This avoids auto-focusing in Cordova applications. */
			_enabled: {
				type: Boolean,
				value: false
			}
	    },
		
	    behaviors: [
   			Polymer.IronA11yKeysBehavior
   	    ],

		keyBindings: {
			'enter': '_search'
		},

	    // Private methods
	    _enable: function(e) {
	    	this._enabled = true;
			this.$.input.focus();
	    },
	    _tapFilter: function(e) {
	    	this.fire('paper-search-filter');
	    },
		_tapClear: function() {
			this.query = "";
			this.$.input.focus();
		},
		_search: function() {
			this._enabled = false;
			
	    	this.fire('paper-search-search');
		}
	});

})();

</script>
